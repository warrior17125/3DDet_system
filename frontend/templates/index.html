<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>nuScenes 3D Detection</title>
    <style>
        .container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .camera-view {
            position: relative;
            border: 1px solid #ccc;
        }
        .pointcloud-view {
            height: 600px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div v-for="(img, index) in images" :key="index" class="camera-view">
            <img :src="img.url" style="width:100%">
            <canvas class="bbox-canvas" :id="'canvas'+index"></canvas>
        </div>
    </div>
    <div id="pointcloud-view" class="pointcloud-view"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script>
        const app = new Vue({
            el: 'body',
            data: {
                images: [],
                scene: null,
                camera: null,
                renderer: null
            },
            mounted() {
                this.initThreeJS();
                this.loadSample('your-sample-token');
            },
            methods: {
                async loadSample(sampleToken) {
                    const response = await fetch(`/api/sample/${sampleToken}`);
                    const data = await response.json();
                    
                    // 加载图像
                    this.images = data.images;
                    this.$nextTick(() => {
                        this.draw2DBBoxes(data.annotations);
                    });
                    
                    // 加载点云
                    this.loadPointCloud(data.pointcloud);
                    this.draw3DBBoxes(data.annotations);
                },
                
                initThreeJS() {
                    // Three.js初始化代码
                    this.scene = new THREE.Scene();
                    this.camera = new THREE.PerspectiveCamera(75, 
                        window.innerWidth/window.innerHeight, 0.1, 1000);
                    this.renderer = new THREE.WebGLRenderer();
                    document.getElementById('pointcloud-view')
                        .appendChild(this.renderer.domElement);
                },
                
                loadPointCloud(pointcloudData) {
                    // 创建点云几何体
                    const geometry = new THREE.BufferGeometry();
                    const vertices = new Float32Array(pointcloudData.points);
                    geometry.setAttribute('position', 
                        new THREE.BufferAttribute(vertices, 3));
                    
                    const material = new THREE.PointsMaterial({
                        color: 0xFFFFFF,
                        size: 0.1
                    });
                    
                    const points = new THREE.Points(geometry, material);
                    this.scene.add(points);
                },
                
                draw3DBBoxes(annotations) {
                    annotations.forEach(ann => {
                        const bbox = new THREE.Box3Helper(
                            new THREE.Box3(
                                new THREE.Vector3(...ann.bbox3d.translation),
                                new THREE.Vector3(...ann.bbox3d.size)
                            ),
                            ann.color
                        );
                        this.scene.add(bbox);
                    });
                },
                
                draw2DBBoxes(annotations) {
                    // 2D投影逻辑（需实现3D到2D的投影计算）
                    // 使用canvas绘制2D边界框
                }
            }
        });
    </script>
</body>
</html>